# 合约测试报告

1.概述：测试的背景、目的和范围

## 1. 测试环境

- Solidity 版本：0.8.x

- 测试框架：Foundry（forge）

- 依赖库：lib/forge-std/src/Test.sol

2.执行测试命令脚本

```
执行测试命令
运行所有测试：
forge test
运行特定测试文件：
forge test --match-path test/Factory.t.sol
运行特定测试函数：
forge test --match-test testCreateExchange
显示详细输出：
forge test -vvv
测试覆盖率
生成覆盖率报告：
forge coverage
生成HTML格式的覆盖率报告：
forge coverage --report lcov
```



## 2.覆盖的主要功能

**Token 合约**

- 代币铸造与分发

- 转账与授权

- 余额与总供应量查询

用例描述：



测试结果

```
Ran 5 tests for test/Token.t.sol:TokenTest
[PASS] testApprove() (gas: 38485)
[PASS] testInitialSupply() (gas: 19011)
[PASS] testTransfer() (gas: 47868)
[PASS] testTransferFrom() (gas: 55044)
[PASS] test_RevertWhen_TransferExceedsBalance() (gas: 15236)
Suite result: ok. 5 passed; 0 failed; 0 skipped; finished in 589.50µs (498.70µs CPU time)
```

**Factory 合约**

- 创建交易所

- 查询交易所地址

测试结果

```
Ran 3 tests for test/Factory.t.sol:FactoryTest
[PASS] testCannotCreateExchangeWithZeroToken() (gas: 8907)
[PASS] testCreateExchange() (gas: 1075269)
[PASS] testCreateExchangeFailsIfExists() (gas: 1073958)
Suite result: ok. 3 passed; 0 failed; 0 skipped; finished in 1.25ms (1.09ms CPU time)
```

**Exchange 合约**

- 添加流动性

- 移除流动性

- ETH 与 Token 兑换

- Token 与 ETH 兑换

- Token 与 Token 兑换

- 滑点保护

- 事件触发

- LP 代币铸造与销毁

测试结果

```
Ran 4 tests for test/Exchange_Swap.t.sol:ExchangeSwapTest
[PASS] testEthToTokenSwap() (gas: 46811)
[PASS] testTokenToEthSwap() (gas: 45182)
[PASS] test_RevertWhen_EthToToken_minTokensTooHigh() (gas: 26557)
[PASS] test_RevertWhen_TokenToEth_minEthTooHigh() (gas: 19533)
Suite result: ok. 4 passed; 0 failed; 0 skipped; finished in 1.12ms (404.30µs CPU time)

Ran 2 tests for test/Exchange_AddLiquidity.t.sol:ExchangeTest
[PASS] testAdditionalLiquidityAdd() (gas: 131785)
[PASS] testInitialLiquidityAdd() (gas: 112098)
Suite result: ok. 2 passed; 0 failed; 0 skipped; finished in 889.20µs (591.30µs CPU time)

Ran 5 tests for test/Exchange_Getprices.sol:GetPricesTest
[PASS] testGetEthAmount() (gas: 19024)
[PASS] testGetPrice_invalidZeroInput() (gas: 9010)
[PASS] testGetPrice_invalidZeroOutput() (gas: 9075)
[PASS] testGetPrice_valid() (gas: 9530)
[PASS] testGetTokenAmount() (gas: 19206)
Suite result: ok. 5 passed; 0 failed; 0 skipped; finished in 1.54ms (2.58ms CPU time)

Ran 3 tests for test/Exchange_RemoveLiquidity.t.sol:ExchangeRemoveLiquidityTest     
[PASS] testRemoveAllLiquidity() (gas: 46171)
[PASS] testRemovePartialLiquidity() (gas: 60456)
[PASS] test_RevertWhen_RemoveZeroLiquidity() (gas: 8939)
Suite result: ok. 3 passed; 0 failed; 0 skipped; finished in 1.65ms (861.30µs CPU time)
```

测试结果测试覆盖率

| File             | % Lines        | % Statements   | % Branches     | % Funcs        |
| :--------------- | :------------- | :------------- | :------------- | :------------- |
| src/Exchange.sol | 87.18% (68/78) | 87.91% (80/91) | 68.18% (15/22) | 84.62% (11/13) |
| src/Factory.sol  | 100.00% (9/9)  | 100.00% (8/8)  | 100.00% (4/4)  | 100.00% (2/2)  |
| src/Token.sol    | 100.00% (2/2)  | 100.00% (1/1)  | 100.00% (0/0)  | 100.00% (1/1)  |

